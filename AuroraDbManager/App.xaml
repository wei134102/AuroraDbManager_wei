<Application x:Class="AuroraDbManager.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:AuroraDbManager.Classes.Controls"
             ShutdownMode="OnExplicitShutdown">
    <Application.Resources>
        <!-- 颜色定义 -->
        <Color x:Key="PrimaryColor">#2196F3</Color>
        <Color x:Key="PrimaryLightColor">#64B5F6</Color>
        <Color x:Key="PrimaryDarkColor">#1976D2</Color>
        <Color x:Key="AccentColor">#FF4081</Color>
        <Color x:Key="BackgroundColor">#F5F5F5</Color>
        <Color x:Key="ForegroundColor">#212121</Color>
        <Color x:Key="BorderColor">#BDBDBD</Color>
        
        <!-- 画笔定义 -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="{StaticResource PrimaryColor}"/>
        <SolidColorBrush x:Key="PrimaryLightBrush" Color="{StaticResource PrimaryLightColor}"/>
        <SolidColorBrush x:Key="PrimaryDarkBrush" Color="{StaticResource PrimaryDarkColor}"/>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>
        <SolidColorBrush x:Key="BackgroundBrush" Color="{StaticResource BackgroundColor}"/>
        <SolidColorBrush x:Key="ForegroundBrush" Color="{StaticResource ForegroundColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{StaticResource BorderColor}"/>
        
        <Geometry x:Key="ArrowLeft">M0,5 L10,10 10,0Z</Geometry>
        <Geometry x:Key="ArrowRight">M0,0 L10,5 L0,10Z</Geometry>
        <Geometry x:Key="TabMenuButton">M0,1 H0,5 M7,8 L0,8 0,2 10,2 L10,5 M10,8 L10,10 8,10Z</Geometry>
        <Thickness x:Key="TabPanelScrollControlsPanelMargin">5,0,0,2</Thickness>
        <Color x:Key="BorderColorBase">#888</Color>
        <Color x:Key="TabControlBackgroundColorBase">#EEF7FF</Color>
        <Color x:Key="TabPanelBackgroundColorBase">Transparent</Color>
        <Color x:Key="LineButtonBackgroundColorBright">LightGoldenrodYellow</Color>
        <Color x:Key="LineButtonBackgroundColorDark">#FAEEB1</Color>
        <Color x:Key="LineButtonBackgroundColorDisabledBright">#EEE</Color>
        <Color x:Key="LineButtonBackgroundColorDisabledDark">#999</Color>
        <SolidColorBrush x:Key="TabItemBorderBrushSelected" Color="{StaticResource BorderColorBase}" />
        <SolidColorBrush x:Key="LineButtonBorderBrush" Color="#8693BD" />
        <SolidColorBrush x:Key="LineButtonBrush" Color="#14273D" />
        <SolidColorBrush x:Key="MenuItemDisabledForegroundBrush" Color="#AAA" />
        <SolidColorBrush x:Key="MenuItemDisabledBackgroundBrush" Color="#1555" />
        <LinearGradientBrush x:Key="TabPanelBackgroundBrush" StartPoint="0,0" EndPoint="0,1">
            <LinearGradientBrush.GradientStops>
                <GradientStop Offset="0.98" Color="{StaticResource TabPanelBackgroundColorBase}" />
                <GradientStop Offset="0.99" Color="{StaticResource BorderColorBase}" />
            </LinearGradientBrush.GradientStops>
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="LineButtonHoverBrush" StartPoint="0.5,0" EndPoint="0.5,1">
            <GradientStop Color="#FFFFD5A0" Offset="0.3" />
            <GradientStop Color="#FFFFA335" Offset="0.51" />
            <GradientStop Color="#FFFFC14A" Offset="0.986" />
        </LinearGradientBrush>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1" x:Key="LineButtonBackgroundBrush">
            <GradientStop Offset="0.3" Color="{StaticResource LineButtonBackgroundColorBright}" />
            <GradientStop Offset="0.4" Color="{StaticResource LineButtonBackgroundColorDark}" />
            <GradientStop Offset="1" Color="{StaticResource LineButtonBackgroundColorBright}" />
        </LinearGradientBrush>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1" x:Key="LineButtonPressedBrush">
            <GradientStop Offset="0" Color="{StaticResource LineButtonBackgroundColorBright}" />
            <GradientStop Offset="0.6" Color="{StaticResource LineButtonBackgroundColorDark}" />
            <GradientStop Offset="0.7" Color="{StaticResource LineButtonBackgroundColorBright}" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="TabMenuButtonBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Offset="0" Color="White" />
            <GradientStop Offset="1" Color="#F3F3E3" />
        </LinearGradientBrush>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1" x:Key="LineButtonDisabledBrush">
            <GradientStop Offset="0" Color="{StaticResource LineButtonBackgroundColorDisabledBright}" />
            <GradientStop Offset="1" Color="{StaticResource LineButtonBackgroundColorDisabledDark}" />
        </LinearGradientBrush>
        <LinearGradientBrush x:Key="TabItemMenuBackcolor" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Offset="0" Color="White" />
            <GradientStop Offset="1" Color="#EEE" />
        </LinearGradientBrush>
        <sys:Double xmlns:sys="clr-namespace:System;assembly=mscorlib" x:Key="ButtonWidthAndHeight">18</sys:Double>
        
        <!-- 按钮样式 -->
        <Style x:Key="ModernButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryLightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryDarkBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#CCCCCC"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 菜单样式 -->
        <Style x:Key="ModernMenuStyle" TargetType="{x:Type Menu}">
            <Setter Property="Background" Value="White"/>
        </Style>
        
        <Style x:Key="ModernMenuItemStyle" TargetType="{x:Type MenuItem}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>
        
        <!-- 工具栏样式 -->
        <Style x:Key="ModernToolBarStyle" TargetType="{x:Type ToolBar}">
            <Setter Property="Background" Value="{StaticResource BackgroundBrush}"/>
        </Style>
        
        <!-- 状态栏样式 -->
        <Style x:Key="ModernStatusBarStyle" TargetType="{x:Type StatusBar}">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        
        <!-- DataGrid样式 -->
        <Style x:Key="ModernDataGridStyle" TargetType="{x:Type DataGrid}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="AlternatingRowBackground" Value="#F9F9F9"/>
            <Setter Property="RowBackground" Value="White"/>
        </Style>
        
        <Style x:Key="LineButtonStyle" TargetType="{x:Type RepeatButton}">
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Height" Value="{StaticResource ButtonWidthAndHeight}" />
            <Setter Property="Width" Value="{StaticResource ButtonWidthAndHeight}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type RepeatButton}">
                        <Border Name="ButtonBorder" Margin="1" BorderBrush="{StaticResource LineButtonBorderBrush}"
                                Background="{StaticResource LineButtonBackgroundBrush}" CornerRadius="1"
                                BorderThickness="1">
                            <ContentPresenter HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter TargetName="ButtonBorder" Property="Background"
                                        Value="{StaticResource LineButtonHoverBrush}" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="true">
                                <Setter TargetName="ButtonBorder" Property="Background"
                                        Value="{StaticResource LineButtonPressedBrush}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="ButtonBorder" Property="Background"
                                        Value="{StaticResource LineButtonDisabledBrush}" />
                                <Setter TargetName="ButtonBorder" Property="Opacity" Value="0.4" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="TabMenuButtonStyle" TargetType="{x:Type MenuItem}">
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Height" Value="{StaticResource ButtonWidthAndHeight}" />
            <Setter Property="Width" Value="{StaticResource ButtonWidthAndHeight}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Border Name="ButtonBorder" Margin="1" BorderBrush="{StaticResource LineButtonBorderBrush}"
                                Background="{StaticResource LineButtonBackgroundBrush}" CornerRadius="1"
                                BorderThickness="1">
                            <Grid>
                                <ContentPresenter ContentSource="Header" HorizontalAlignment="Stretch"
                                                  VerticalAlignment="Stretch">
                                    <ContentPresenter.Content>
                                        <Path Margin="2" Data="{StaticResource TabMenuButton}"
                                              Stroke="{StaticResource LineButtonBrush}"
                                              Fill="{StaticResource TabMenuButtonBrush}" Stretch="Fill"
                                              VerticalAlignment="Center" HorizontalAlignment="Center" />
                                    </ContentPresenter.Content>
                                </ContentPresenter>
                                <Popup Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsSubmenuOpen}"
                                       AllowsTransparency="True" Focusable="False" PopupAnimation="Fade">
                                    <Border Name="SubmenuBorder" Margin="1,1,9,9" SnapsToDevicePixels="True"
                                            BorderBrush="{StaticResource LineButtonBorderBrush}"
                                            Background="{StaticResource TabItemMenuBackcolor}" CornerRadius="1"
                                            BorderThickness="1">
                                        <StackPanel IsItemsHost="True"
                                                    KeyboardNavigation.DirectionalNavigation="Cycle" />
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="true">
                                <Setter TargetName="ButtonBorder" Property="Background"
                                        Value="{StaticResource LineButtonHoverBrush}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="TabMenuItem" TargetType="{x:Type MenuItem}">
            <Setter Property="Header" Value="{Binding Path=Header}" />
            <Setter Property="IsEnabled" Value="{Binding Path=IsEnabled}" />
            <Setter Property="IsCheckable" Value="{Binding Path=IsEnabled}" />
            <Setter Property="IsChecked" Value="{Binding Path=IsSelected, Mode=TwoWay}" />
        </Style>
        <Style TargetType="{x:Type TabControl}">
            <Setter Property="SnapsToDevicePixels" Value="true" />
            <Setter Property="BorderThickness" Value="1,0,1,1" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabControl">
                        <Grid KeyboardNavigation.TabNavigation="Local">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Border Name="TabPanelBorder" Height="30"
                                    Background="{StaticResource TabPanelBackgroundBrush}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <ScrollViewer Grid.Row="0" Grid.RowSpan="2" VerticalScrollBarVisibility="Disabled"
                                                  CanContentScroll="True" HorizontalScrollBarVisibility="Hidden"
                                                  IsDeferredScrollingEnabled="False" SnapsToDevicePixels="True"
                                                  Name="svTP" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                        <local:ScrollableTabPanel IsItemsHost="True"
                                                                  x:Name="PART_ScrollContentPresenter" Margin="0"
                                                                  RightOverflowMargin="4" AnimationTimeSpan="0:0:0.25"
                                                                  LineScrollPixelCount="100"
                                                                  KeyboardNavigation.TabIndex="1" />
                                    </ScrollViewer>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal"
                                                Margin="{StaticResource TabPanelScrollControlsPanelMargin}">
                                        <RepeatButton x:Name="cmdScrollLeft" Style="{StaticResource LineButtonStyle}"
                                                      CommandTarget="{Binding ElementName=svTP}"
                                                      Command="ScrollBar.LineLeftCommand"
                                                      IsEnabled="{Binding ElementName=PART_ScrollContentPresenter, Path=CanScrollLeft}">
                                            <Path Margin="4,3" Data="{StaticResource ArrowLeft}"
                                                  Stroke="{StaticResource LineButtonBrush}"
                                                  Fill="{StaticResource LineButtonBrush}" Stretch="Fill"
                                                  VerticalAlignment="Center" HorizontalAlignment="Center" />
                                        </RepeatButton>
                                        <RepeatButton x:Name="cmdScrollRight" Style="{StaticResource LineButtonStyle}"
                                                      CommandTarget="{Binding ElementName=svTP}"
                                                      Command="ScrollBar.LineRightCommand"
                                                      IsEnabled="{Binding ElementName=PART_ScrollContentPresenter, Path=CanScrollRight}">
                                            <Path Margin="4,3" Data="{StaticResource ArrowRight}"
                                                  Stroke="{StaticResource LineButtonBrush}"
                                                  Fill="{StaticResource LineButtonBrush}" Stretch="Fill"
                                                  VerticalAlignment="Center" HorizontalAlignment="Center" />
                                        </RepeatButton>
                                        <Menu Background="Transparent">
                                            <MenuItem Style="{StaticResource TabMenuButtonStyle}"
                                                      ItemsSource="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type TabControl}}, Path=Items}"
                                                      ItemContainerStyle="{StaticResource TabMenuItem}" />
                                        </Menu>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            <Border BorderThickness="1,0,1,1" Grid.Row="1"
                                    BorderBrush="{StaticResource TabItemBorderBrushSelected}" Background="WhiteSmoke">
                                <Border BorderThickness="1" BorderBrush="Transparent" CornerRadius="4" Margin="4">
                                    <ContentPresenter x:Name="PART_SelectedContentHost" ContentSource="SelectedContent"
                                                      Margin="0" />
                                </Border>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <ContentControl Content="{Binding}">
                            <ToolTipService.ToolTip>
                                <ToolTip Content="{TemplateBinding Content}"/>
                            </ToolTipService.ToolTip>
                        </ContentControl>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Application.Resources>
</Application>